 -- 5.3 Agregar dependencias necesarias

pip install cryptography django-environ zeep requests
Raz√≥n del cambio: Se agregaron estas librer√≠as para adaptar el proyecto a un entorno profesional: cryptography es obligatoria para autenticarse en MySQL 8.0 (est√°ndar actual), django-environ permite conectar Django con Docker leyendo las credenciales de forma segura desde variables de entorno, y zeep (con requests) es necesaria para que tus scripts de prueba puedan consumir y verificar el servicio SOAP, algo que la gu√≠a original no contemplaba.

 -- 5.4 Configuraci√≥n de Variables de Entorno

Crea un archivo .env en la ra√≠z del proyecto:

DJANGO_SECRET_KEY=tu_clave_secreta
DEBUG=True
ALLOWED_HOST=localhost
DB_NAME=biblioteca_dbutres
DB_USER=root
DB_PASSWORD=root_password
DB_HOST=localhost
DB_PORT=3306
Raz√≥n del cambio: Se agreg√≥ un archivo .env para centralizar y proteger las credenciales de la base de datos y la configuraci√≥n de Django, haciendo el proyecto m√°s seguro y f√°cil de desplegar en diferentes entornos (como Docker).

-- 6.1 settings.py
1. Implementaci√≥n de Variables de Entorno (django-environ)
C√≥digo Agregado:

import environ
import os

config = environ.Env()
environ.Env.read_env(os.path.join(BASE_DIR, '.env'))

2. Actualizaci√≥n de la Configuraci√≥n de la Base de Datos
C√≥digo Modificado:

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': config('DB_NAME'),
        'USER': config('DB_USER'),
        'PASSWORD': config('DB_PASSWORD'),
        'HOST': config('DB_HOST'),
        'PORT': config('DB_PORT'),
        'OPTIONS': {
            'init_command': "SET sql_mode='STRICT_TRANS_TABLES'",
            'charset': 'utf8mb4',
        },
    }
}
Raz√≥n del cambio: Se reemplazaron las credenciales codificadas (hardcoded) por llamadas a la librer√≠a django-environ. Esto permite que el proyecto lea la configuraci√≥n desde el archivo .env, facilitando la gesti√≥n de credenciales y la portabilidad entre entornos (desarrollo, pruebas, producci√≥n).

3. Configuraci√≥n de Variables de Entorno
C√≥digo Agregado:

SECRET_KEY = config('DJANGO_SECRET_KEY')
DEBUG = config('DEBUG')
ALLOWED_HOSTS = [config('ALLOWED_HOST'), 'localhost']
Raz√≥n del cambio: Se reemplazaron las credenciales codificadas (hardcoded) por llamadas a la librer√≠a django-environ. Esto permite que el proyecto lea la configuraci√≥n desde el archivo .env, facilitando la gesti√≥n de credenciales y la portabilidad entre entornos (desarrollo, pruebas, producci√≥n).

4. Flujo de Usuario (Redirecciones)
C√≥digo Agregado:

LOGIN_URL = '/login/'
LOGIN_REDIRECT_URL = '/'
LOGOUT_REDIRECT_URL = '/'
Raz√≥n del cambio: Se configuraron las URL para el flujo de autenticaci√≥n. Ahora, si un usuario intenta acceder a una ruta protegida sin estar autenticado, ser√° redirigido a /login/. Una vez autenticado, ser√° redirigido a la p√°gina principal (/), y al cerrar sesi√≥n, ser√° redirigido nuevamente a /login/.

 -- 7.1 Agregar a models.py
 1. L√≥gica de Negocio en el Modelo (Propiedad esta_vencido)
C√≥digo Agregado (Final del archivo):

    @property
    def esta_vencido(self):
        from datetime import date
        # Verifica si el pr√©stamo sigue activo y si la fecha l√≠mite ya pas√≥
        if self.estado in ['activo', 'renovado'] and self.fecha_devolucion_esperada < date.today():
            return True
        return False

 -- 9.1 Agregar a serializers.py
 1. Serializaci√≥n de la Propiedad esta_vencido

 //PrestamoSerializer
 def validate(self, data):
        """Validar que hay stock disponible"""
        libro = data.get('libro')
        if libro and libro.stock_disponible <= 0:
            raise serializers.ValidationError(
                "No hay ejemplares disponibles de este libro."
            )
        return data

//PrestamoSerializer
2. Automatizaci√≥n de Inventario
C√≥digo Agregado (Final del archivo):

    def create(self, validated_data):
        """Crear pr√©stamo y actualizar stock"""
        prestamo = super().create(validated_data)
        libro = prestamo.libro
        libro.stock_disponible -= 1
        libro.save()
        return prestamo

 -- 9.2 views.py
//Borrar el view.py que esta en la guia original, cambiar por el que esta en el archivo "Views y Urls Completos"

 1. Correcci√≥n de Nombres de Relaci√≥n (Bug Fix Cr√≠tico)
C√≥digo Modificado (en estadisticas):

libros_por_categoria = Categoria.objects.annotate(
    total=Count('libros')  # <-- Uso del related_name correcto
).order_by('-total')

2. L√≥gica de Pr√©stamos Renovados (Mejora de L√≥gica)
C√≥digo Modificado (en mi_cuenta):

prestamos_activos = Prestamo.objects.filter(
    usuario=request.user,
    estado__in=['activo', 'renovado'] # <-- Incluye renovados
)

3. Agregar login y logout

def cerrar_sesion(request):
    """
    Cierra la sesi√≥n del usuario y muestra la p√°gina de despedida.
    """
    logout(request) # 1. Esto borra la sesi√≥n y las cookies del usuario
    
    # 2. Renderiza tu template nuevo
    return render(request, 'libros/logout.html')

def iniciar_sesion(request):
    # 1. Si enviaron el formulario (POST)
    if request.method == 'POST':
        form = AuthenticationForm(request, data=request.POST)
        if form.is_valid():
            # Usuario y contrase√±a correctos
            usuario = form.get_user()
            login(request, usuario)  # Crea la sesi√≥n
            return redirect('catalogo') # <--- CAMBIA 'catalogo' por el nombre de tu pagina de inicio
    
    # 2. Si solo est√°n entrando a la p√°gina (GET)
    else:
        form = AuthenticationForm()
    
    return render(request, 'libros/login.html', {'form': form})

 -- 9.3 biblioteca_project/urls.py
//Borrar el urls.py que esta en la guia original, se revolvia el projecto y la app
//Cambiar por esto:

from django.contrib import admin
from django.urls import path, include, re_path
from django.contrib.auth import views as auth_views
from libros.soap_services import soap_view
from . import views as project_views # Alias para evitar conflicto si importas views de la app

# Importamos el router desde tu app libros
from libros.urls import router as libros_router

urlpatterns = [
    # 1. P√°gina principal y Ejemplos (Tus views actuales del proyecto)
    path('', project_views.home, name='home'),
    path('ejemplos/rest/', project_views.ejemplos_rest, name='ejemplos_rest'),
    path('ejemplos/soap/', project_views.ejemplos_soap, name='ejemplos_soap'),
    path('ejemplos/admin/', project_views.ejemplos_admin, name='ejemplos_admin'),

    # 2. Admin de Django
    path('admin/', admin.site.urls),

    # 3. Servicio SOAP
    re_path(r'^soap/', soap_view),

    # 4. API REST (Conectado al Router)
    # Esto generar√° rutas como: /api/libros/, /api/autores/
    path('api/', include(libros_router.urls)),

    # 5. Vistas de la App Libros (Cat√°logo, Detalles, etc.)
    path('', include('libros.urls')),

    # 6. Autenticaci√≥n
    path('login/', auth_views.LoginView.as_view(template_name='login.html'), name='login'),
    path('logout/', auth_views.LogoutView.as_view(next_page='/'), name='logout'),
]

 -- 9.4 libros/urls.py
//Borrar el urls.py que esta en la guia original, se revolvia el projecto y la app
//Cambiar por esto:

from django.urls import path
from rest_framework.routers import DefaultRouter
from . import views

# --- Configuraci√≥n de la API ---
# Definimos el router aqu√≠ para poder importarlo desde el urls.py principal
router = DefaultRouter()
router.register(r'libros', views.LibroViewSet)
router.register(r'autores', views.AutorViewSet)
router.register(r'categorias', views.CategoriaViewSet)
router.register(r'editoriales', views.EditorialViewSet)
router.register(r'prestamos', views.PrestamoViewSet)

# --- Configuraci√≥n de Vistas Tradicionales (HTML) ---
urlpatterns = [
    # Nota: Quitamos el router de aqu√≠ para manejarlo en el archivo principal
    
    path('index/', views.index, name='index'),
    path('catalogo/', views.catalogo, name='catalogo'),
    
    # Correg√≠ las rutas que ten√≠an "//" vac√≠os agregando el par√°metro <int:pk>
    path('libro/<int:pk>/', views.detalle_libro, name='detalle_libro'),
    
    path('busqueda/', views.busqueda, name='busqueda'),
    path('estadisticas/', views.estadisticas, name='estadisticas'),
    path('mi-cuenta/', views.mi_cuenta, name='mi_cuenta'),

    path('logout/', views.cerrar_sesion, name='logout'),
    path('login/', views.iniciar_sesion, name='login'),
    
    path('solicitar-prestamo/<int:libro_id>/', views.solicitar_prestamo, name='solicitar_prestamo'),
    path('renovar-prestamo/<int:prestamo_id>/', views.renovar_prestamo, name='renovar_prestamo'),
]

 -- 10.1 biblioteca_project/soap_services.py
// Cambiar por esto:

from spyne.model.complex import ComplexModel
from spyne.protocol.soap import Soap11
from spyne.server.django import DjangoApplication
from .models import Libro
from django.http import HttpResponse

# --- 1. MODELOS SOAP ---

class SoapAutor(ComplexModel):
    nombre = String
    apellido = String

class SoapLibro(ComplexModel):
    id = Integer
    titulo = String
    autor_nombre = String
    autor = SoapAutor
    stock_disponible = Integer
    numero_paginas = Integer
    idioma = String

class SoapResponse(ComplexModel):
    exito = Boolean
    mensaje = String
    id = Integer(min_occurs=0, nillable=True)

# --- 2. SERVICIO ---

class BibliotecaService(ServiceBase):
    
    @rpc(_returns=Array(SoapLibro))
    def listar_libros(ctx):
        libros = Libro.objects.all().select_related('autor')
        resultado = []
        for libro in libros:
            s_libro = SoapLibro()
            s_libro.id = libro.id
            s_libro.titulo = libro.titulo
            s_libro.stock_disponible = getattr(libro, 'stock', 1)
            
            # Nombre del autor (manejo de errores)
            try:
                if hasattr(libro.autor, 'nombre_completo'):
                    s_libro.autor_nombre = libro.autor.nombre_completo
                else:
                    s_libro.autor_nombre = f"{libro.autor.nombre} {libro.autor.apellido}"
            except:
                s_libro.autor_nombre = "Autor Desconocido"

            # Objeto autor anidado
            s_autor = SoapAutor()
            try:
                s_autor.nombre = libro.autor.nombre
                s_autor.apellido = libro.autor.apellido
            except:
                s_autor.nombre = "Desconocido"
                s_autor.apellido = ""
            
            s_libro.autor = s_autor
            resultado.append(s_libro)
        return resultado

    @rpc(Integer, _returns=SoapLibro)
    def obtener_libro(ctx, pk):
        try:
            libro = Libro.objects.get(pk=pk)
            s_libro = SoapLibro()
            s_libro.id = libro.id
            s_libro.titulo = libro.titulo
            s_libro.stock_disponible = getattr(libro, 'stock', 1)
            s_libro.numero_paginas = getattr(libro, 'paginas', 0)
            s_libro.idioma = getattr(libro, 'idioma', 'Espa√±ol')
            
            # Manejo de nombre simple
            try:
                s_libro.autor_nombre = f"{libro.autor.nombre} {libro.autor.apellido}"
            except:
                s_libro.autor_nombre = "Desconocido"

            s_autor = SoapAutor()
            try:
                s_autor.nombre = libro.autor.nombre
                s_autor.apellido = libro.autor.apellido
            except:
                s_autor.nombre = "Desconocido"
            
            s_libro.autor = s_autor
            return s_libro
        except Libro.DoesNotExist:
            return None

    @rpc(Integer, Integer, Integer, _returns=SoapResponse)
    def crear_prestamo(ctx, libro_id, usuario_id, dias):
        # L√≥gica simulada para evitar errores si no existen los modelos
        resp = SoapResponse()
        resp.exito = True
        resp.mensaje = f"Pr√©stamo registrado (Simulado): Libro {libro_id} a Usuario {usuario_id}"
        resp.id = 999
        return resp

# --- 3. CONFIGURACI√ìN Y VISTA SEGURA ---

application = Application(
    [BibliotecaService],
    tns='biblioteca.soap',
    in_protocol=Soap11(validator='lxml'),
    out_protocol=Soap11()
)

# Instancia pura de Spyne
_django_app = DjangoApplication(application)

@csrf_exempt
def soap_view(request):
    """
    Vista puente que desactiva CSRF y pasa la petici√≥n a Spyne.
    """
    return _django_app(request)

 

 -- 11.2 Templates biblioteca_project/:
 1. biblioteca_project/templates/libros/
// Cambiar por esto, muchos cambios: 
<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de Biblioteca - Inicio</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --primary: #6366f1;
        --secondary: #a855f7;
        --text-dark: #1f2937;
        --text-light: #6b7280;
        --bg-white: #ffffff;
        --light-gray: #f3f4f6;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        color: var(--text-dark);
      }

      .container {
        max-width: 1100px;
        width: 100%;
        background: var(--bg-white);
        border-radius: 24px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      /* Header m√°s moderno */
      .header {
        background: #fff;
        padding: 40px 20px 20px;
        text-align: center;
        border-bottom: 1px solid #e5e7eb;
      }

      .header h1 {
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(to right, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 10px;
        letter-spacing: -0.025em;
      }

      .header p {
        color: var(--text-light);
        font-size: 1.1rem;
      }

      .content {
        padding: 40px;
        background: #f9fafb;
      }

      /* Secci√≥n de Estad√≠sticas (Ahora tiene estilo) */
      .stats {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 40px;
        flex-wrap: wrap;
      }

      .stat-box {
        background: white;
        padding: 20px 40px;
        border-radius: 16px;
        text-align: center;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        min-width: 150px;
        border: 1px solid #e5e7eb;
      }

      .stat-box .number {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--primary);
        line-height: 1;
        margin-bottom: 5px;
      }

      .stat-box .label {
        color: var(--text-light);
        font-weight: 500;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.05em;
      }

      /* Grid de Servicios */
      .services {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
      }

      .service-card {
        background: white;
        border-radius: 20px;
        padding: 30px;
        text-align: center;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid transparent;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .service-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        border-color: #e5e7eb;
      }

      /* Estilo para los iconos/emojis */
      .icon {
        font-size: 2.5rem;
        margin-bottom: 20px;
        background: #f3f4f6;
        width: 80px;
        height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: transform 0.3s ease;
      }

      .service-card:hover .icon {
        transform: scale(1.1) rotate(5deg);
        background: #e0e7ff;
      }

      .service-card h3 {
        margin-bottom: 20px;
        color: var(--text-dark);
        font-size: 1.25rem;
      }

      /* Contenedor de botones para separarlos */
      .btn-container {
        display: flex;
        flex-direction: column;
        gap: 10px;
        width: 100%;
        margin-top: auto; /* Empuja los botones al fondo */
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 12px 24px;
        text-decoration: none;
        border-radius: 12px;
        transition: all 0.2s ease;
        font-weight: 600;
        font-size: 0.95rem;
        cursor: pointer;
      }

      /* Bot√≥n Primario (Acci√≥n principal) */
      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary) 0%,
          var(--secondary) 100%
        );
        color: white;
        box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
      }

      .btn-primary:hover {
        filter: brightness(110%);
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
      }

      /* Bot√≥n Secundario (Ejemplos) */
      .btn-secondary {
        background: white;
        color: var(--text-dark);
        border: 2px solid #e5e7eb;
      }

      .btn-secondary:hover {
        border-color: var(--primary);
        color: var(--primary);
        background: #f9fafb;
      }

      /* NUEVOS ESTILOS PARA EL FOOTER CON EL BOT√ìN */
      .footer-action {
        margin-top: 50px;
        padding-top: 30px;
        border-top: 2px dashed #e5e7eb;
        text-align: center;
        width: 100%;
      }

      .btn-large {
        font-size: 1.2rem;
        padding: 18px 50px;
        border-radius: 50px;
        width: auto;
        min-width: 250px;
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 2rem;
        }
        .content {
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üìö Sistema de Biblioteca</h1>
        <p>Gesti√≥n Integral de Biblioteca con Servicios Web</p>
      </div>

      <div class="content">
        <div class="stats">
          <div class="stat-box">
            <div class="number">{{ total_libros }}</div>
            <div class="label">Libros Disponibles</div>
          </div>
        </div>

        <div class="services">
          <div class="service-card">
            <div class="icon">üîê</div>
            <h3>Panel de Administraci√≥n</h3>
            <div class="btn-container">
              <a href="/admin/" class="btn btn-primary">Acceder al Admin</a>
              <a href="/ejemplos/admin/" class="btn btn-secondary"
                >üìö Ver Ejemplos</a
              >
            </div>
          </div>

          <div class="service-card">
            <div class="icon">üåê</div>
            <h3>API REST</h3>
            <div class="btn-container">
              <a href="/api/" class="btn btn-primary">Documentaci√≥n API</a>
              <a href="/ejemplos/rest/" class="btn btn-secondary"
                >üìö Ver Ejemplos</a
              >
            </div>
          </div>

          <div class="service-card">
            <div class="icon">üßº</div>
            <h3>Servicio SOAP</h3>
            <div class="btn-container">
              <a href="/soap/?wsdl" class="btn btn-primary">Ver WSDL</a>
              <a href="/ejemplos/soap/" class="btn btn-secondary"
                >üìö Ver Ejemplos</a
              >
            </div>
          </div>
        </div>

        <div class="footer-action">
            <p style="margin-bottom: 15px; color: #6b7280;">¬øQuieres navegar por el cat√°logo?</p>
            <a href="{% url 'index' %}" class="btn btn-primary btn-large">
                üöÄ Ingresar a la Plataforma
            </a>
        </div>

      </div>
    </div>
  </body>
</html>

2. biblioteca_project/templates/base.html
// Cambiar por esto, cambios en los enrutamientos:
{% load static %} <!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Sistema de Biblioteca{% endblock %}</title>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- FontAwesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
  </head>
  <body>
    <nav class="navbar">
      <div class="container">
        <a href="{% url 'index' %}" class="logo">üìö Biblioteca UTH</a>
        <ul class="nav-menu">
          <li><a href="{% url 'catalogo' %}">Cat√°logo</a></li>
          <li><a href="{% url 'busqueda' %}">Buscar</a></li>
          <li><a href="{% url 'estadisticas' %}">Estad√≠sticas</a></li>
          {% if user.is_authenticated %}
          <li><a href="{% url 'mi_cuenta' %}">Mi Cuenta</a></li>
          <li><a href="/admin/">Admin</a></li>
          <li><a href="{% url 'logout' %}">Salir</a></li>
          {% else %}
          <li><a href="{% url 'login' %}">Ingresar</a></li>
          {% endif %}
        </ul>
      </div>
    </nav>

    <main class="main-content">{% block content %}{% endblock %}</main>

    <footer class="footer">
      <div class="container">
        <p>¬© 2026 Sistema de Biblioteca UTH - Servicios Web</p>
        <p>API REST | SOAP | MySQL | Django 5.2</p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/main.js' %}"></script>
    {% block extra_js %}{% endblock %}
  </body>
</html>

3. biblioteca_project/templates/ejemplos_admin.html
//Poner el c√≥digo en alguna parte de la gu√≠a, lo tuve que sacar de las devtools, mucha gente no sabe que las devtools existen
// Cambie el enrutamiento de la p√°gina de inicio, ahora se redirige al home.html

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejemplos Panel Admin - Sistema de Biblioteca</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .nav {
            background: #f8f9fa;
            padding: 15px 40px;
            border-bottom: 2px solid #e0e0e0;
        }
        .nav a {
            color: #667eea;
            text-decoration: none;
            margin-right: 20px;
            font-weight: 600;
        }
        .content { padding: 40px; }
        .section { margin-bottom: 50px; }
        .section h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        .admin-card {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .admin-card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        .description {
            color: #666;
            line-height: 1.6;
            margin: 10px 0;
        }
        .feature-list {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 20px;
            margin: 10px 0;
        }
        .feature-list ul {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .feature-list li:before {
            content: "‚úì ";
            color: #667eea;
            font-weight: bold;
            margin-right: 10px;
        }
        .credentials {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .credentials code {
            background: #fff;
            padding: 2px 8px;
            border-radius: 3px;
            color: #d63384;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            margin-top: 10px;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .screenshot {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
        }
        .step {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .warning {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Ejemplos Panel de Administraci√≥n</h1>
            <p>Gu√≠a completa de uso del sistema administrativo Django</p>
        </div>

        <div class="nav">
            <a href="{% url 'home' %}">Volver al Inicio</a>
        </div>
        
        <div class="content">
            <div class="section">
                <h2>üöÄ Acceso al Panel</h2>
                <div class="admin-card">
                    <h3>Credenciales de Acceso</h3>
                    <div class="credentials">
                        <strong>Administrador:</strong><br>
                        Usuario: <code>admin</code><br>
                        Contrase√±a: <code>admin123</code><br><br>
                        
                        <strong>Usuarios est√°ndar:</strong><br>
                        <code>juan_perez</code>, <code>maria_lopez</code>, <code>carlos_ruiz</code><br>
                        Contrase√±a: <code>user123</code>
                    </div>
                    <a href="/admin/" target="_blank" class="btn">üîê Abrir Panel Admin</a>
                </div>
            </div>

            <div class="section">
                <h2>üìö Gesti√≥n de Libros</h2>
                
                <div class="admin-card">
                    <h3>¬øQu√© puedes hacer?</h3>
                    <p class="description">
                        El m√≥dulo de libros permite gesti√≥n completa del cat√°logo de la biblioteca.
                    </p>
                    
                    <div class="feature-list">
                        <h4>Operaciones disponibles:</h4>
                        <ul>
                            <li><strong>Crear libro:</strong> Agregar nuevos t√≠tulos al cat√°logo</li>
                            <li><strong>Editar libro:</strong> Actualizar informaci√≥n, stock, ubicaci√≥n</li>
                            <li><strong>Eliminar libro:</strong> Quitar t√≠tulos del sistema</li>
                            <li><strong>Buscar libro:</strong> Por t√≠tulo, ISBN, autor</li>
                            <li><strong>Filtrar:</strong> Por categor√≠a, autor, editorial, estado</li>
                            <li><strong>Acciones en lote:</strong> Eliminar m√∫ltiples libros a la vez</li>
                        </ul>
                    </div>
                    
                    <div class="step">
                        <h4>Ejemplo: Crear un nuevo libro</h4>
                        <ol style="margin-left: 20px; margin-top: 10px;">
                            <li>Ir a: <strong>Admin ‚Üí Libros ‚Üí Agregar libro</strong></li>
                            <li>Completar formulario:
                                <ul style="margin-left: 20px;">
                                    <li>T√≠tulo: "El t√∫nel"</li>
                                    <li>ISBN: "9788432217203"</li>
                                    <li>Autor: Seleccionar de la lista</li>
                                    <li>Editorial, Categor√≠a, Fecha de publicaci√≥n</li>
                                    <li>Stock total y disponible</li>
                                    <li>Ubicaci√≥n f√≠sica: "Estante G-15"</li>
                                </ul>
                            </li>
                            <li>Click en <strong>"Guardar"</strong></li>
                        </ol>
                    </div>
                    
                    <div class="step">
                        <h4>Ejemplo: Buscar libros de Garc√≠a M√°rquez</h4>
                        <ol style="margin-left: 20px; margin-top: 10px;">
                            <li>Ir a: <strong>Admin ‚Üí Libros</strong></li>
                            <li>En el cuadro de b√∫squeda escribir: <code>garc√≠a m√°rquez</code></li>
                            <li>Ver resultados filtrados</li>
                            <li>Click en cualquier libro para editar</li>
                        </ol>
                    </div>
                </div>
                
                <div class="admin-card">
                    <h3>Campos y Validaciones</h3>
                    <div class="feature-list">
                        <strong>Campos obligatorios:</strong>
                        <ul>
                            <li>T√≠tulo</li>
                            <li>ISBN (√∫nico, 13 d√≠gitos)</li>
                            <li>Autor</li>
                            <li>Editorial</li>
                            <li>Categor√≠a</li>
                        </ul>
                    </div>
                    <div class="warning">
                        <strong>Validaci√≥n autom√°tica:</strong> El sistema no permite ISBNs duplicados ni stock negativo.
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>‚úçÔ∏è Gesti√≥n de Autores</h2>
                
                <div class="admin-card">
                    <h3>Administrar Autores</h3>
                    <p class="description">
                        Gestiona la informaci√≥n de los autores de la biblioteca.
                    </p>
                    
                    <div class="feature-list">
                        <h4>Funcionalidades:</h4>
                        <ul>
                            <li><strong>Crear autor:</strong> Nombre, apellido, biograf√≠a, nacionalidad</li>
                            <li><strong>Editar autor:</strong> Actualizar informaci√≥n biogr√°fica</li>
                            <li><strong>Ver libros:</strong> Lista de libros del autor</li>
                            <li><strong>Buscar:</strong> Por nombre o apellido</li>
                        </ul>
                    </div>
                    
                    <div class="step">
                        <h4>Ejemplo: Agregar nuevo autor</h4>
                        <ol style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Admin ‚Üí Autores ‚Üí Agregar autor</strong></li>
                            <li>Completar:
                                <ul style="margin-left: 20px;">
                                    <li>Nombre: "Julio"</li>
                                    <li>Apellido: "Cort√°zar"</li>
                                    <li>Fecha nacimiento: "26/08/1914"</li>
                                    <li>Nacionalidad: "Argentino"</li>
                                    <li>Biograf√≠a: "Escritor, traductor..."</li>
                                </ul>
                            </li>
                            <li>Guardar</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üìã Gesti√≥n de Pr√©stamos</h2>
                
                <div class="admin-card">
                    <h3>Control de Pr√©stamos</h3>
                    <p class="description">
                        El m√≥dulo m√°s importante: gestiona el ciclo completo de pr√©stamos y devoluciones.
                    </p>
                    
                    <div class="feature-list">
                        <h4>Operaciones clave:</h4>
                        <ul>
                            <li><strong>Crear pr√©stamo:</strong> Registrar salida de libro</li>
                            <li><strong>Marcar devoluci√≥n:</strong> Registrar retorno de libro</li>
                            <li><strong>Renovar pr√©stamo:</strong> Extender fecha de devoluci√≥n</li>
                            <li><strong>Aplicar multas:</strong> Por devoluci√≥n tard√≠a</li>
                            <li><strong>Filtrar por estado:</strong> activo, devuelto, vencido</li>
                            <li><strong>Ver historial:</strong> Pr√©stamos de un usuario</li>
                        </ul>
                    </div>
                    
                    <div class="step">
                        <h4>Ejemplo: Registrar nuevo pr√©stamo</h4>
                        <ol style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Admin ‚Üí Pr√©stamos ‚Üí Agregar pr√©stamo</strong></li>
                            <li>Seleccionar:
                                <ul style="margin-left: 20px;">
                                    <li>Libro: Buscar por t√≠tulo</li>
                                    <li>Usuario: Seleccionar de la lista</li>
                                    <li>Fecha devoluci√≥n esperada: +14 d√≠as</li>
                                    <li>Notas (opcional)</li>
                                </ul>
                            </li>
                            <li>Guardar</li>
                            <li><strong>Efecto:</strong> Stock del libro se reduce autom√°ticamente</li>
                        </ol>
                    </div>
                    
                    <div class="step">
                        <h4>Ejemplo: Marcar libro como devuelto</h4>
                        <ol style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Admin ‚Üí Pr√©stamos</strong></li>
                            <li>Buscar el pr√©stamo activo</li>
                            <li>Click para editar</li>
                            <li>Cambiar estado a: <strong>"devuelto"</strong></li>
                            <li>Registrar fecha_devolucion_real</li>
                            <li>Si hay retraso, aplicar multa</li>
                            <li>Guardar</li>
                            <li><strong>Efecto:</strong> Stock del libro aumenta autom√°ticamente</li>
                        </ol>
                    </div>
                    
                    <div class="step">
                        <h4>Ejemplo: Ver pr√©stamos vencidos</h4>
                        <ol style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Admin ‚Üí Pr√©stamos</strong></li>
                            <li>En el filtro lateral, seleccionar: <strong>Estado ‚Üí vencido</strong></li>
                            <li>Ver lista de pr√©stamos no devueltos a tiempo</li>
                            <li>Click en cada uno para gestionar multas</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üë• Gesti√≥n de Usuarios</h2>
                
                <div class="admin-card">
                    <h3>Administrar Usuarios</h3>
                    <p class="description">
                        Control completo de usuarios del sistema con permisos granulares.
                    </p>
                    
                    <div class="feature-list">
                        <h4>Funcionalidades:</h4>
                        <ul>
                            <li><strong>Crear usuario:</strong> Nuevo miembro de la biblioteca</li>
                            <li><strong>Asignar permisos:</strong> Bibliotecario, admin, usuario</li>
                            <li><strong>Cambiar contrase√±a:</strong> Reset de credenciales</li>
                            <li><strong>Desactivar cuenta:</strong> Sin eliminar historial</li>
                            <li><strong>Ver pr√©stamos:</strong> Historial del usuario</li>
                        </ul>
                    </div>
                    
                    <div class="step">
                        <h4>Ejemplo: Crear nuevo usuario</h4>
                        <ol style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Admin ‚Üí Usuarios ‚Üí Agregar usuario</strong></li>
                            <li>Completar:
                                <ul style="margin-left: 20px;">
                                    <li>Nombre de usuario: "pedro_sanchez"</li>
                                    <li>Contrase√±a (2 veces para confirmar)</li>
                                    <li>Nombre: "Pedro"</li>
                                    <li>Apellido: "S√°nchez"</li>
                                    <li>Email: "pedro@email.com"</li>
                                </ul>
                            </li>
                            <li>Permisos (opcional):
                                <ul style="margin-left: 20px;">
                                    <li>‚òê Superusuario</li>
                                    <li>‚òê Personal</li>
                                    <li>‚òë Activo</li>
                                </ul>
                            </li>
                            <li>Guardar</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üè∑Ô∏è Categor√≠as y Editoriales</h2>
                
                <div class="admin-card">
                    <h3>Gesti√≥n de Cat√°logos</h3>
                    
                    <div class="step">
                        <h4>Agregar Categor√≠a</h4>
                        <ol style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Admin ‚Üí Categor√≠as ‚Üí Agregar categor√≠a</strong></li>
                            <li>Nombre: "Biograf√≠as"</li>
                            <li>Descripci√≥n: "Biograf√≠as y memorias"</li>
                            <li>Guardar</li>
                        </ol>
                    </div>
                    
                    <div class="step">
                        <h4>Agregar Editorial</h4>
                        <ol style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Admin ‚Üí Editoriales ‚Üí Agregar editorial</strong></li>
                            <li>Nombre: "Penguin Random House"</li>
                            <li>Pa√≠s: "Estados Unidos"</li>
                            <li>Sitio web: "https://www.penguinrandomhouse.com"</li>
                            <li>Fecha fundaci√≥n: "01/07/2013"</li>
                            <li>Guardar</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üìä Reportes y Estad√≠sticas</h2>
                
                <div class="admin-card">
                    <h3>Informaci√≥n del Sistema</h3>
                    <p class="description">
                        El panel admin muestra estad√≠sticas en tiempo real:
                    </p>
                    
                    <div class="feature-list">
                        <ul>
                            <li>Total de libros en el cat√°logo</li>
                            <li>Libros disponibles vs prestados</li>
                            <li>N√∫mero de autores registrados</li>
                            <li>Pr√©stamos activos</li>
                            <li>Pr√©stamos vencidos (requieren atenci√≥n)</li>
                            <li>Usuarios registrados</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üí° Casos de Uso Pr√°cticos</h2>
                
                <div class="admin-card">
                    <h3>Caso 1: Usuario solicita libro en mostrador</h3>
                    <div class="step">
                        <ol style="margin-left: 20px;">
                            <li>Buscar libro por t√≠tulo en <strong>Admin ‚Üí Libros</strong></li>
                            <li>Verificar que <code>stock_disponible > 0</code></li>
                            <li>Ir a <strong>Admin ‚Üí Pr√©stamos ‚Üí Agregar</strong></li>
                            <li>Seleccionar libro y usuario</li>
                            <li>Fecha devoluci√≥n: 14 d√≠as desde hoy</li>
                            <li>Guardar ‚Üí Sistema reduce stock autom√°ticamente</li>
                        </ol>
                    </div>
                </div>
                
                <div class="admin-card">
                    <h3>Caso 2: Usuario devuelve libro con retraso</h3>
                    <div class="step">
                        <ol style="margin-left: 20px;">
                            <li>Buscar pr√©stamo en <strong>Admin ‚Üí Pr√©stamos</strong></li>
                            <li>Filtrar por usuario o libro</li>
                            <li>Abrir el pr√©stamo activo</li>
                            <li>Estado ‚Üí <strong>"devuelto"</strong></li>
                            <li>Fecha devoluci√≥n real ‚Üí hoy</li>
                            <li>Sistema calcula d√≠as de retraso</li>
                            <li>Aplicar multa: $10 por d√≠a = $30</li>
                            <li>Agregar notas: "Libro en buen estado"</li>
                            <li>Guardar ‚Üí Stock se incrementa autom√°ticamente</li>
                        </ol>
                    </div>
                </div>
                
                <div class="admin-card">
                    <h3>Caso 3: Inventario semanal</h3>
                    <div class="step">
                        <ol style="margin-left: 20px;">
                            <li><strong>Admin ‚Üí Libros</strong></li>
                            <li>Revisar filtros:
                                <ul style="margin-left: 20px;">
                                    <li>Estado: "disponible" ‚Üí Verificar ubicaci√≥n f√≠sica</li>
                                    <li>Estado: "prestado" ‚Üí Verificar con pr√©stamos activos</li>
                                </ul>
                            </li>
                            <li><strong>Admin ‚Üí Pr√©stamos</strong></li>
                            <li>Filtrar por estado: "vencido"</li>
                            <li>Contactar usuarios con pr√©stamos vencidos</li>
                            <li>Actualizar multas pendientes</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üîí Permisos y Seguridad</h2>
                
                <div class="admin-card">
                    <h3>Niveles de Acceso</h3>
                    
                    <div class="credentials">
                        <strong>Superusuario (admin):</strong><br>
                        ‚úÖ Acceso completo a todas las secciones<br>
                        ‚úÖ Puede crear/editar/eliminar cualquier registro<br>
                        ‚úÖ Gestiona usuarios y permisos<br>
                        ‚úÖ Acceso a configuraci√≥n del sistema
                    </div>
                    
                    <div class="credentials">
                        <strong>Usuario est√°ndar:</strong><br>
                        ‚ùå No tiene acceso al panel admin<br>
                        ‚úÖ Solo puede usar la API REST (solo lectura)<br>
                        ‚úÖ Puede ver su propio historial de pr√©stamos
                    </div>
                    
                    <div class="warning">
                        <strong>Importante:</strong> Nunca compartas las credenciales de administrador. Crea usuarios espec√≠ficos con los permisos m√≠nimos necesarios.
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script>'undefined'=== typeof _trfq || (window._trfq = []);'undefined'=== typeof _trfd && (window._trfd=[]),_trfd.push({'tccl.baseHost':'secureserver.net'},{'ap':'cpsh-oh'},{'server':'p3plzcpnl504927'},{'dcenter':'p3'},{'cp_id':'10837813'},{'cp_cl':'8'}) // Monitoring performance to make your website faster. If you want to opt-out, please contact web hosting support.</script><script src='https://img1.wsimg.com/traffic-assets/js/tccl.min.js'></script></html>

4. biblioteca_project/templates/ejemplos_rest.html
// Igual que el html anterior
// Modifique el script para que funcione correctamente las "Pruebas"

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejemplos API REST - Sistema de Biblioteca</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .nav {
            background: #f8f9fa;
            padding: 15px 40px;
            border-bottom: 2px solid #e0e0e0;
        }
        .nav a {
            color: #667eea;
            text-decoration: none;
            margin-right: 20px;
            font-weight: 600;
        }
        .content { padding: 40px; }
        .section { margin-bottom: 50px; }
        .section h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #28a745;
        }
        .api-card {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .api-card h3 {
            color: #28a745;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .method {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 5px;
            color: white;
            font-size: 0.85em;
            font-weight: bold;
        }
        .method.get { background: #28a745; }
        .method.post { background: #007bff; }
        .method.put { background: #ffc107; color: #333; }
        .method.delete { background: #dc3545; }
        .endpoint {
            background: #2d2d2d;
            color: #4ec9b0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
            word-break: break-all;
        }
        .example {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
        }
        .example h4 {
            color: #666;
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        pre {
            background: #2d2d2d;
            color: #dcdcdc;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 10px 0;
            font-size: 0.9em;
        }
        .response {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .try-it {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        .try-it:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }
        .description {
            color: #666;
            line-height: 1.6;
            margin: 10px 0;
        }
        .params {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .params h4 {
            color: #856404;
            margin-bottom: 10px;
        }
        .params ul {
            list-style: none;
            padding: 0;
        }
        .params li {
            padding: 5px 0;
            color: #666;
        }
        .params code {
            background: #fff;
            padding: 2px 6px;
            border-radius: 3px;
            color: #d63384;
        }
        #testResults { display: none; }
        .effect-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåê Ejemplos API REST</h1>
            <p>Gu√≠a completa con ejemplos pr√°cticos de uso del API RESTful</p>
        </div>
        
        <div class="nav">
            <a href="{% url 'home' %}">Volver al Inicio</a>
        </div>
        
        <div class="content">
            <!-- LIBROS -->
            <div class="section">
                <h2>üìö Gesti√≥n de Libros</h2>
                
                <div class="api-card">
                    <h3><span class="method get">GET</span> Listar todos los libros</h3>
                    <div class="endpoint">GET http://127.0.0.1:8000/api/libros/</div>
                    <p class="description">
                        <strong>¬øQu√© hace?</strong> Obtiene una lista paginada de todos los libros con informaci√≥n completa.
                    </p>
                    <p class="description">
                        <strong>¬øQu√© genera?</strong> JSON con t√≠tulo, autor, editorial, ISBN, stock disponible, categor√≠a y m√°s.
                    </p>
                    <div class="example">
                        <h4>Respuesta:</h4>
                        <pre>{
  "count": 7,
  "results": [{
    "id": 1,
    "titulo": "Cien a√±os de soledad",
    "isbn": "9780307474728",
    "autor_nombre": "Gabriel Garc√≠a M√°rquez",
    "stock_disponible": 3,
    "estado": "disponible"
  }]
}</pre>
                    </div>
                    <button class="try-it" onclick="testAPI('GET', '/api/libros/')">üß™ Probar</button>
                </div>
                
                <div class="api-card">
                    <h3><span class="method get">GET</span> Buscar libros</h3>
                    <div class="endpoint">GET http://127.0.0.1:8000/api/libros/?search=garc√≠a</div>
                    <p class="description">
                        <strong>¬øQu√© hace?</strong> Busca libros por t√≠tulo, autor o ISBN. Case-insensitive.
                    </p>
                    <p class="description">
                        <strong>¬øQu√© genera?</strong> Lista filtrada de libros que coincidan con el criterio.
                    </p>
                    <div class="params">
                        <h4>Variantes de b√∫squeda:</h4>
                        <ul>
                            <li><code>?search=amor</code> - Busca "amor" en t√≠tulo/autor/ISBN</li>
                            <li><code>?categoria=1</code> - Filtra por categor√≠a Ficci√≥n</li>
                            <li><code>?estado=disponible</code> - Solo libros disponibles</li>
                            <li><code>?autor=1</code> - Libros de Garc√≠a M√°rquez</li>
                            <li><code>?search=cien&estado=disponible</code> - Combinar filtros</li>
                        </ul>
                    </div>
                    <button class="try-it" onclick="testAPI('GET', '/api/libros/?search=garc√≠a')">üß™ Buscar "garc√≠a"</button>
                    <button class="try-it" onclick="testAPI('GET', '/api/libros/?categoria=1')">üß™ Categor√≠a Ficci√≥n</button>
                </div>
                
                <div class="api-card">
                    <h3><span class="method get">GET</span> Obtener libro espec√≠fico</h3>
                    <div class="endpoint">GET http://127.0.0.1:8000/api/libros/1/</div>
                    <p class="description">
                        <strong>¬øQu√© hace?</strong> Obtiene detalles completos de un libro por su ID.
                    </p>
                    <p class="description">
                        <strong>¬øQu√© genera?</strong> Objeto JSON con TODOS los campos del libro, incluyendo descripci√≥n, ubicaci√≥n f√≠sica, fechas, etc.
                    </p>
                    <button class="try-it" onclick="testAPI('GET', '/api/libros/1/')">üß™ Ver Libro #1</button>
                    <button class="try-it" onclick="testAPI('GET', '/api/libros/4/')">üß™ Ver Libro #4</button>
                </div>
            </div>
            
            <!-- AUTORES -->
            <div class="section">
                <h2>‚úçÔ∏è Gesti√≥n de Autores</h2>
                
                <div class="api-card">
                    <h3><span class="method get">GET</span> Listar autores</h3>
                    <div class="endpoint">GET http://127.0.0.1:8000/api/autores/</div>
                    <p class="description">
                        <strong>¬øQu√© hace?</strong> Lista todos los autores con biograf√≠a, nacionalidad y fecha de nacimiento.
                    </p>
                    <p class="description">
                        <strong>¬øQu√© genera?</strong> Array con informaci√≥n completa de cada autor, incluyendo conteo de sus libros.
                    </p>
                    <div class="example">
                        <h4>Ejemplo de respuesta:</h4>
                        <pre>{
  "results": [{
    "id": 1,
    "nombre": "Gabriel",
    "apellido": "Garc√≠a M√°rquez",
    "fecha_nacimiento": "1927-03-06",
    "nacionalidad": "Colombiano",
    "biografia": "Premio Nobel...",
    "total_libros": 2
  }]
}</pre>
                    </div>
                    <button class="try-it" onclick="testAPI('GET', '/api/autores/')">üß™ Ver Autores</button>
                </div>
                
                <div class="api-card">
                    <h3><span class="method get">GET</span> Ver autor espec√≠fico</h3>
                    <div class="endpoint">GET http://127.0.0.1:8000/api/autores/1/</div>
                    <p class="description">
                        <strong>¬øQu√© hace?</strong> Muestra informaci√≥n detallada de un autor y sus libros.
                    </p>
                    <button class="try-it" onclick="testAPI('GET', '/api/autores/1/')">üß™ Garc√≠a M√°rquez</button>
                </div>
            </div>
            
            <!-- PRESTAMOS -->
            <div class="section">
                <h2>üìã Gesti√≥n de Pr√©stamos</h2>
                
                <div class="api-card">
                    <h3><span class="method get">GET</span> Listar pr√©stamos</h3>
                    <div class="endpoint">GET http://127.0.0.1:8000/api/prestamos/</div>
                    <p class="description">
                        <strong>¬øQu√© hace?</strong> Lista todos los pr√©stamos con informaci√≥n del libro, usuario y fechas.
                    </p>
                    <p class="description">
                        <strong>¬øQu√© genera?</strong> Array con pr√©stamos mostrando estado, fechas de pr√©stamo/devoluci√≥n, multas.
                    </p>
                    <div class="params">
                        <h4>Filtros disponibles:</h4>
                        <ul>
                            <li><code>?estado=activo</code> - Pr√©stamos activos</li>
                            <li><code>?estado=devuelto</code> - Pr√©stamos ya devueltos</li>
                            <li><code>?estado=vencido</code> - Pr√©stamos vencidos</li>
                            <li><code>?usuario=2</code> - Pr√©stamos de un usuario espec√≠fico</li>
                            <li><code>?libro=1</code> - Pr√©stamos de un libro espec√≠fico</li>
                        </ul>
                    </div>
                    <button class="try-it" onclick="testAPI('GET', '/api/prestamos/')">üß™ Todos</button>
                    <button class="try-it" onclick="testAPI('GET', '/api/prestamos/?estado=activo')">üß™ Activos</button>
                    <button class="try-it" onclick="testAPI('GET', '/api/prestamos/?estado=devuelto')">üß™ Devueltos</button>
                </div>
                
                <div class="api-card">
                    <h3><span class="method post">POST</span> Crear pr√©stamo</h3>
                    <div class="endpoint">POST http://127.0.0.1:8000/api/prestamos/</div>
                    <p class="description">
                        <strong>¬øQu√© hace?</strong> Crea un nuevo pr√©stamo y actualiza autom√°ticamente el stock del libro.
                    </p>
                    <p class="description">
                        <strong>¬øQu√© genera?</strong> Registro del pr√©stamo creado + reduce stock_disponible del libro en 1.
                    </p>
                    <div class="example">
                        <h4>Body JSON requerido:</h4>
                        <pre>{
  "libro": 3,
  "usuario": 2,
  "fecha_devolucion_esperada": "2026-02-15",
  "notas": "Pr√©stamo est√°ndar"
}</pre>
                    </div>
                    <div class="effect-box">
                        <strong>Efectos autom√°ticos:</strong><br>
                        ‚úÖ stock_disponible del libro se reduce en 1<br>
                        ‚úÖ Si stock llega a 0, estado del libro cambia a "prestado"<br>
                        ‚úÖ Se registra fecha de pr√©stamo autom√°ticamente<br>
                        ‚úÖ Estado inicial es "activo"
                    </div>
                    <p class="description"><em>Nota: Requiere autenticaci√≥n de administrador</em></p>
                </div>
            </div>
            
            <!-- CATEGORIAS Y EDITORIALES -->
            <div class="section">
                <h2>üè∑Ô∏è Categor√≠as y Editoriales</h2>
                
                <div class="api-card">
                    <h3><span class="method get">GET</span> Listar categor√≠as</h3>
                    <div class="endpoint">GET http://127.0.0.1:8000/api/categorias/</div>
                    <p class="description">
                        <strong>¬øQu√© hace?</strong> Lista todas las categor√≠as de libros con descripci√≥n.
                    </p>
                    <p class="description">
                        <strong>¬øQu√© genera?</strong> Array con id, nombre y descripci√≥n de cada categor√≠a.
                    </p>
                    <button class="try-it" onclick="testAPI('GET', '/api/categorias/')">üß™ Ver Categor√≠as</button>
                </div>
                
                <div class="api-card">
                    <h3><span class="method get">GET</span> Listar editoriales</h3>
                    <div class="endpoint">GET http://127.0.0.1:8000/api/editoriales/</div>
                    <p class="description">
                        <strong>¬øQu√© hace?</strong> Lista editoriales con pa√≠s, sitio web y fecha de fundaci√≥n.
                    </p>
                    <button class="try-it" onclick="testAPI('GET', '/api/editoriales/')">üß™ Ver Editoriales</button>
                </div>
            </div>
            
            <!-- PAGINACION -->
            <div class="section">
                <h2>üìÑ Paginaci√≥n</h2>
                
                <div class="api-card">
                    <h3><span class="method get">GET</span> Navegaci√≥n por p√°ginas</h3>
                    <div class="endpoint">GET http://127.0.0.1:8000/api/libros/?page=1</div>
                    <p class="description">
                        <strong>¬øQu√© hace?</strong> Divide resultados en p√°ginas de 10 elementos cada una.
                    </p>
                    <p class="description">
                        <strong>¬øQu√© genera?</strong> JSON con count total, URLs next/previous, y results de la p√°gina actual.
                    </p>
                    <div class="example">
                        <h4>Estructura de respuesta:</h4>
                        <pre>{
  "count": 25,
  "next": "http://127.0.0.1:8000/api/libros/?page=2",
  "previous": null,
  "results": [...]
}</pre>
                    </div>
                </div>
            </div>
            
            <!-- CASOS DE USO -->
            <div class="section">
                <h2>üí° Casos de Uso Completos</h2>
                
                <div class="api-card">
                    <h3>Caso 1: Usuario busca y presta un libro</h3>
                    <div class="effect-box">
                        <strong>Escenario:</strong> Usuario busca libros de Garc√≠a M√°rquez, verifica disponibilidad y solicita pr√©stamo.
                    </div>
                    <div class="example">
                        <h4>Paso 1: Buscar</h4>
                        <pre>GET /api/libros/?search=garc√≠a%20m√°rquez</pre>
                        <h4>Paso 2: Verificar stock</h4>
                        <pre>GET /api/libros/1/
‚Üí Verifica stock_disponible > 0</pre>
                        <h4>Paso 3: Crear pr√©stamo</h4>
                        <pre>POST /api/prestamos/
{
  "libro": 1,
  "usuario": 2,
  "fecha_devolucion_esperada": "2026-02-15"
}</pre>
                        <h4>Resultado:</h4>
                        <div class="response">
                            ‚úÖ stock_disponible: 3 ‚Üí 2<br>
                            ‚úÖ Pr√©stamo creado con estado "activo"<br>
                            ‚úÖ Libro sigue "disponible" (hay m√°s en stock)
                        </div>
                    </div>
                    <button class="try-it" onclick="demonstrateCase1()">üß™ Demostrar Caso</button>
                </div>
                
                <div class="api-card">
                    <h3>Caso 2: Bibliotecario busca pr√©stamos vencidos</h3>
                    <div class="effect-box">
                        <strong>Escenario:</strong> Necesita identificar usuarios con libros no devueltos a tiempo.
                    </div>
                    <div class="example">
                        <pre>GET /api/prestamos/?estado=vencido</pre>
                        <div class="response">
                            Retorna lista con:<br>
                            ‚úÖ Pr√©stamos donde fecha_devolucion_esperada < hoy<br>
                            ‚úÖ Informaci√≥n del usuario<br>
                            ‚úÖ Informaci√≥n del libro<br>
                            ‚úÖ D√≠as de retraso<br>
                            ‚úÖ Multas aplicadas
                        </div>
                    </div>
                    <button class="try-it" onclick="testAPI('GET', '/api/prestamos/?estado=vencido')">üß™ Ver Vencidos</button>
                </div>
            </div>
            
            <!-- TEST AREA -->
            <div class="section">
                <h2>üß™ √Årea de Pruebas</h2>
                <div id="testResults">
                    <div class="api-card">
                        <h3>Resultado:</h3>
                        <div id="testOutput"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
    // Funci√≥n para obtener el CSRF Token de las cookies de Django
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    async function testAPI(method, endpoint, body = null) {
        const resultsDiv = document.getElementById('testResults');
        const outputDiv = document.getElementById('testOutput');
        
        resultsDiv.style.display = 'block';
        outputDiv.innerHTML = '<p>‚è≥ Realizando petici√≥n...</p>';
        
        // Usamos rutas relativas (quitamos el http://127.0.0.1:8000)
        // para que funcione en cualquier entorno
        const url = endpoint; 

        const headers = {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken') // Agregamos token de seguridad
        };

        const config = {
            method: method,
            headers: headers
        };

        if (body) {
            config.body = JSON.stringify(body);
        }

        try {
            const response = await fetch(url, config);
            
            // Intentamos parsear a JSON, si falla (ej. error 500 html), capturamos texto
            let data;
            const contentType = response.headers.get("content-type");
            if (contentType && contentType.indexOf("application/json") !== -1) {
                data = await response.json();
            } else {
                data = await response.text();
            }
            
            // Colorear el estado seg√∫n el c√≥digo
            const statusColor = response.ok ? '#4caf50' : '#dc3545';
            const statusBg = response.ok ? '#e8f5e9' : '#f8d7da';

            outputDiv.innerHTML = `
                <div class="response" style="border-left-color: ${statusColor}; background: ${statusBg}">
                    <strong>Status:</strong> <span style="color:${statusColor}">${response.status} ${response.statusText}</span><br>
                    <strong>Endpoint:</strong> ${method} ${endpoint}
                </div>
                <pre>${typeof data === 'object' ? JSON.stringify(data, null, 2) : data}</pre>
            `;
            
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        } catch (error) {
            outputDiv.innerHTML = `<div style="background: #ffebee; border-left: 4px solid #f44336; padding: 15px;">
                <strong>Error de conexi√≥n:</strong> ${error.message}<br>
                <small>Verifica que el servidor est√© corriendo y la URL sea correcta.</small>
            </div>`;
        }
    }
    
    async function demonstrateCase1() {
        const resultsDiv = document.getElementById('testResults');
        const outputDiv = document.getElementById('testOutput');
        
        resultsDiv.style.display = 'block';
        outputDiv.innerHTML = '<p>‚è≥ Ejecutando demostraci√≥n paso a paso...</p>';
        
        try {
            // Paso 1: Buscar
            const searchRes = await fetch('/api/libros/?search=garc√≠a');
            const searchData = await searchRes.json();
            
            let libro = null;
            let stockMsg = "No se encontraron libros";
            
            if (searchData.results && searchData.results.length > 0) {
                libro = searchData.results[0];
                stockMsg = `‚úÖ "${libro.titulo}" tiene <strong>${libro.stock_disponible}</strong> unidades disponibles`;
            }

            outputDiv.innerHTML = `
                <div class="example">
                    <h4>Paso 1: Resultados de b√∫squeda (GET /api/libros/?search=garc√≠a)</h4>
                    <pre>${JSON.stringify(libro || searchData, null, 2)}</pre>
                </div>
                <div class="example">
                    <h4>Paso 2: Verificaci√≥n de Stock</h4>
                    <div class="response">${stockMsg}</div>
                </div>
                <div class="example">
                    <h4>Paso 3: Simulaci√≥n de Pr√©stamo</h4>
                    <p>Para completar el ciclo, se enviar√≠a la siguiente petici√≥n:</p>
                    <pre>POST /api/prestamos/
Headers: { "X-CSRFToken": "..." }
Body: {
  "libro": ${libro ? libro.id : 1},
  "usuario": 2, // ID de usuario actual
  "fecha_devolucion_esperada": "2026-02-20"
}</pre>
                    <div class="info-box" style="background: #e3f2fd; padding: 10px; border-radius: 4px;">
                        ‚ÑπÔ∏è <em>Esta acci√≥n requiere estar logueado como administrador en este demo.</em>
                    </div>
                </div>
            `;
            
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        } catch (error) {
            outputDiv.innerHTML = `<div style="background: #ffebee; padding: 15px;">Error en la demo: ${error.message}</div>`;
        }
    }
</script>
    
    
</body>
<script>'undefined'=== typeof _trfq || (window._trfq = []);'undefined'=== typeof _trfd && (window._trfd=[]),_trfd.push({'tccl.baseHost':'secureserver.net'},{'ap':'cpsh-oh'},{'server':'p3plzcpnl504927'},{'dcenter':'p3'},{'cp_id':'10837813'},{'cp_cl':'8'}) // Monitoring performance to make your website faster. If you want to opt-out, please contact web hosting support.</script><script src='https://img1.wsimg.com/traffic-assets/js/tccl.min.js'></script></html>

5. biblioteca_project/templates/ejemplos_soap.html
// igual que lo anterior

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejemplos SOAP - Sistema de Biblioteca</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2196f3 0%, #21cbf3 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .nav {
            background: #f8f9fa;
            padding: 15px 40px;
            border-bottom: 2px solid #e0e0e0;
        }
        .nav a {
            color: #667eea;
            text-decoration: none;
            margin-right: 20px;
            font-weight: 600;
        }
        .content { padding: 40px; }
        .section { margin-bottom: 50px; }
        .section h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #2196f3;
        }
        .soap-card {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .soap-card h3 {
            color: #2196f3;
            margin-bottom: 10px;
        }
        .endpoint {
            background: #2d2d2d;
            color: #4ec9b0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
            word-break: break-all;
        }
        .example {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
        }
        .example h4 {
            color: #666;
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        pre {
            background: #2d2d2d;
            color: #dcdcdc;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 10px 0;
            font-size: 0.85em;
        }
        .description {
            color: #666;
            line-height: 1.6;
            margin: 10px 0;
        }
        .info-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .btn {
            background: linear-gradient(135deg, #2196f3 0%, #21cbf3 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            margin-top: 10px;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üßº Ejemplos Servicio SOAP</h1>
            <p>Gu√≠a completa con ejemplos pr√°cticos de uso del Web Service SOAP</p>
        </div>
        
        <div class="nav">
            <a href="{% url 'home' %}">Volver al Inicio</a>
        </div>
        
        <div class="content">
            <div class="section">
                <h2>üìã ¬øQu√© es SOAP?</h2>
                <div class="soap-card">
                    <p class="description">
                        <strong>SOAP</strong> (Simple Object Access Protocol) es un protocolo de mensajer√≠a basado en XML para intercambio de informaci√≥n estructurada en servicios web.
                    </p>
                    <p class="description">
                        <strong>¬øPara qu√© sirve?</strong> Permite integraci√≥n con sistemas legacy, aplicaciones empresariales, y clientes que requieren contratos formales (WSDL).
                    </p>
                    <p class="description">
                        <strong>Ventajas:</strong> Tipado fuerte, validaci√≥n autom√°tica, soporte en m√∫ltiples lenguajes, est√°ndares empresariales.
                    </p>
                </div>
            </div>

            <div class="section">
                <h2>üìÑ WSDL - Descripci√≥n del Servicio</h2>
                <div class="soap-card">
                    <h3>Acceder al WSDL</h3>
                    <div class="endpoint">GET http://127.0.0.1:8000/soap/?wsdl</div>
                    <p class="description">
                        <strong>¬øQu√© hace?</strong> Genera autom√°ticamente el documento WSDL con la definici√≥n completa del servicio.
                    </p>
                    <p class="description">
                        <strong>¬øQu√© contiene?</strong> Tipos de datos, mensajes, operaciones disponibles, y binding de transporte.
                    </p>
                    <div class="info-box">
                        <strong>Herramientas para probar SOAP:</strong><br>
                        ‚Ä¢ SoapUI - Cliente SOAP dedicado<br>
                        ‚Ä¢ Postman - Soporte para SOAP desde v7.0<br>
                        ‚Ä¢ Python con zeep o suds-jurko<br>
                        ‚Ä¢ cURL - L√≠nea de comandos
                    </div>
                    <a href="/soap/?wsdl" target="_blank" class="btn">üß™ Ver WSDL Completo</a>
                </div>
            </div>

            <div class="section">
                <h2>üìö Operaciones Disponibles</h2>
                
                <div class="soap-card">
                    <h3>1. obtener_libro - Consultar libro por ID</h3>
                    <div class="endpoint">POST http://127.0.0.1:8000/soap/</div>
                    <p class="description">
                        <strong>¬øQu√© hace?</strong> Obtiene informaci√≥n completa de un libro espec√≠fico por su ID.
                    </p>
                    <p class="description">
                        <strong>¬øQu√© genera?</strong> XML con t√≠tulo, ISBN, autor, editorial, stock disponible y estado.
                    </p>
                    
                    <div class="example">
                        <h4>Request SOAP:</h4>
                        <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
               xmlns:tns="http://127.0.0.1:8000/soap/"&gt;
    &lt;soap:Body&gt;
        &lt;tns:obtener_libro&gt;
            &lt;tns:libro_id&gt;1&lt;/tns:libro_id&gt;
        &lt;/tns:obtener_libro&gt;
    &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;</pre>
                    </div>
                    
                    <div class="example">
                        <h4>Response SOAP (exitoso):</h4>
                        <pre>&lt;soap:Envelope&gt;
    &lt;soap:Body&gt;
        &lt;obtener_libroResponse&gt;
            &lt;libro&gt;
                &lt;id&gt;1&lt;/id&gt;
                &lt;titulo&gt;Cien a√±os de soledad&lt;/titulo&gt;
                &lt;isbn&gt;9780307474728&lt;/isbn&gt;
                &lt;autor&gt;Gabriel Garc√≠a M√°rquez&lt;/autor&gt;
                &lt;editorial&gt;Editorial Sudamericana&lt;/editorial&gt;
                &lt;categoria&gt;Ficci√≥n&lt;/categoria&gt;
                &lt;stock_disponible&gt;3&lt;/stock_disponible&gt;
                &lt;estado&gt;disponible&lt;/estado&gt;
            &lt;/libro&gt;
        &lt;/obtener_libroResponse&gt;
    &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;</pre>
                    </div>
                </div>
                
                <div class="soap-card">
                    <h3>2. listar_libros - Obtener todos los libros</h3>
                    <div class="endpoint">POST http://127.0.0.1:8000/soap/</div>
                    <p class="description">
                        <strong>¬øQu√© hace?</strong> Lista todos los libros de la biblioteca.
                    </p>
                    <p class="description">
                        <strong>¬øQu√© genera?</strong> Array XML con la informaci√≥n b√°sica de cada libro.
                    </p>
                    
                    <div class="example">
                        <h4>Request SOAP:</h4>
                        <pre>&lt;soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
               xmlns:tns="http://127.0.0.1:8000/soap/"&gt;
    &lt;soap:Body&gt;
        &lt;tns:listar_libros /&gt;
    &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;</pre>
                    </div>
                    
                    <div class="example">
                        <h4>Response SOAP:</h4>
                        <pre>&lt;soap:Envelope&gt;
    &lt;soap:Body&gt;
        &lt;listar_librosResponse&gt;
            &lt;libros&gt;
                &lt;libro&gt;
                    &lt;id&gt;1&lt;/id&gt;
                    &lt;titulo&gt;Cien a√±os de soledad&lt;/titulo&gt;
                    &lt;autor&gt;Gabriel Garc√≠a M√°rquez&lt;/autor&gt;
                &lt;/libro&gt;
                &lt;libro&gt;
                    &lt;id&gt;2&lt;/id&gt;
                    &lt;titulo&gt;El amor en los tiempos del c√≥lera&lt;/titulo&gt;
                    &lt;autor&gt;Gabriel Garc√≠a M√°rquez&lt;/autor&gt;
                &lt;/libro&gt;
            &lt;/libros&gt;
        &lt;/listar_librosResponse&gt;
    &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;</pre>
                    </div>
                </div>
                
                <div class="soap-card">
                    <h3>3. crear_prestamo - Registrar nuevo pr√©stamo</h3>
                    <div class="endpoint">POST http://127.0.0.1:8000/soap/</div>
                    <p class="description">
                        <strong>¬øQu√© hace?</strong> Crea un nuevo pr√©stamo y actualiza el stock del libro autom√°ticamente.
                    </p>
                    <p class="description">
                        <strong>¬øQu√© genera?</strong> ID del pr√©stamo creado y confirmaci√≥n de √©xito.
                    </p>
                    
                    <div class="example">
                        <h4>Request SOAP:</h4>
                        <pre>&lt;soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
               xmlns:tns="http://127.0.0.1:8000/soap/"&gt;
    &lt;soap:Body&gt;
        &lt;tns:crear_prestamo&gt;
            &lt;tns:libro_id&gt;3&lt;/tns:libro_id&gt;
            &lt;tns:usuario_id&gt;2&lt;/tns:usuario_id&gt;
            &lt;tns:dias&gt;14&lt;/tns:dias&gt;
        &lt;/tns:crear_prestamo&gt;
    &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;</pre>
                    </div>
                    
                    <div class="example">
                        <h4>Response SOAP:</h4>
                        <pre>&lt;soap:Envelope&gt;
    &lt;soap:Body&gt;
        &lt;crear_prestamoResponse&gt;
            &lt;prestamo_id&gt;5&lt;/prestamo_id&gt;
            &lt;mensaje&gt;Pr√©stamo creado exitosamente&lt;/mensaje&gt;
            &lt;fecha_devolucion&gt;2026-02-15&lt;/fecha_devolucion&gt;
        &lt;/crear_prestamoResponse&gt;
    &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;</pre>
                    </div>
                    
                    <div class="info-box">
                        <strong>Efectos autom√°ticos:</strong><br>
                        ‚úÖ Reduce stock_disponible en 1<br>
                        ‚úÖ Cambia estado a "prestado" si stock = 0<br>
                        ‚úÖ Calcula fecha_devolucion_esperada<br>
                        ‚úÖ Registra fecha_prestamo actual
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üêç Ejemplo con Python (zeep)</h2>
                <div class="soap-card">
                    <h3>Cliente SOAP en Python</h3>
                    <p class="description">Usa la biblioteca <code>zeep</code> para consumir el servicio SOAP.</p>
                    
                    <div class="example">
                        <h4>Instalaci√≥n:</h4>
                        <pre>pip install zeep</pre>
                        
                        <h4>C√≥digo Python:</h4>
                        <pre>from zeep import Client

# Conectar al servicio SOAP
wsdl = 'http://127.0.0.1:8000/soap/?wsdl'
client = Client(wsdl=wsdl)

# 1. Obtener un libro
libro = client.service.obtener_libro(libro_id=1)
print(f"Libro: {libro['titulo']}")
print(f"Stock: {libro['stock_disponible']}")

# 2. Listar todos los libros
libros = client.service.listar_libros()
for libro in libros:
    print(f"{libro['id']}: {libro['titulo']}")

# 3. Crear un pr√©stamo
resultado = client.service.crear_prestamo(
    libro_id=3,
    usuario_id=2,
    dias=14
)
print(f"Pr√©stamo creado: ID {resultado['prestamo_id']}")</pre>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üí° Casos de Uso SOAP</h2>
                
                <div class="soap-card">
                    <h3>Caso 1: Sistema externo consulta disponibilidad</h3>
                    <p class="description">
                        <strong>Escenario:</strong> Sistema de pr√©stamos interbibliotecario consulta si un libro est√° disponible.
                    </p>
                    <div class="example">
                        <h4>Flujo:</h4>
                        <pre>1. Sistema externo llama obtener_libro(libro_id=1)
2. Recibe XML con stock_disponible
3. Si stock_disponible > 0, procede con el pr√©stamo
4. Llama crear_prestamo(libro_id=1, usuario_id=X, dias=14)
5. Recibe confirmaci√≥n y ID del pr√©stamo</pre>
                    </div>
                </div>
                
                <div class="soap-card">
                    <h3>Caso 2: Migraci√≥n de datos desde sistema legacy</h3>
                    <p class="description">
                        <strong>Escenario:</strong> Importar cat√°logo completo desde otro sistema.
                    </p>
                    <div class="example">
                        <h4>Proceso:</h4>
                        <pre>1. Llamar listar_libros() para obtener cat√°logo actual
2. Comparar con sistema legacy
3. Identificar libros faltantes
4. Crear registros para sincronizar</pre>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üîß Herramientas Recomendadas</h2>
                <div class="soap-card">
                    <div class="info-box">
                        <strong>SoapUI:</strong> Cliente dedicado para testing SOAP<br>
                        ‚Üí Descarga: <a href="https://www.soapui.org/" target="_blank">soapui.org</a><br><br>
                        
                        <strong>Postman:</strong> Soporte SOAP desde v7.0<br>
                        ‚Üí Importa WSDL: http://127.0.0.1:8000/soap/?wsdl<br><br>
                        
                        <strong>Python zeep:</strong> pip install zeep<br>
                        ‚Üí Documentaci√≥n: <a href="https://docs.python-zeep.org/" target="_blank">docs.python-zeep.org</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script>'undefined'=== typeof _trfq || (window._trfq = []);'undefined'=== typeof _trfd && (window._trfd=[]),_trfd.push({'tccl.baseHost':'secureserver.net'},{'ap':'cpsh-oh'},{'server':'p3plzcpnl504927'},{'dcenter':'p3'},{'cp_id':'10837813'},{'cp_cl':'8'}) // Monitoring performance to make your website faster. If you want to opt-out, please contact web hosting support.</script><script src='https://img1.wsimg.com/traffic-assets/js/tccl.min.js'></script></html>

 -- 11.3 Templates libros/
1. libros/templates/libros/index.html
//Practicamente lo mismo, solamente cambie el estilo

{% extends 'base.html' %} {% load static %} {% block title %}Inicio - Biblioteca
UTH{% endblock %} {% block content %}
<div class="hero-section">
  <div class="container">
    <h1>Bienvenido a la Biblioteca Digital UTH</h1>
    <p>Sistema completo de gesti√≥n con API REST y SOAP</p>
    <div class="hero-buttons">
      <a href="{% url 'catalogo' %}" class="btn btn-primary">Ver Cat√°logo</a>
      <a href="{% url 'busqueda' %}" class="btn btn-secondary">Buscar Libros</a>
    </div>
  </div>
</div>

<div class="stats-section">
  <div class="container">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">üìö</div>
        <div class="stat-number">{{ total_libros }}</div>
        <div class="stat-label">Libros</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">‚úçÔ∏è</div>
        <div class="stat-number">{{ total_autores }}</div>
        <div class="stat-label">Autores</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üìã</div>
        <div class="stat-number">{{ prestamos_activos }}</div>
        <div class="stat-label">Pr√©stamos Activos</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üë•</div>
        <div class="stat-number">{{ total_usuarios }}</div>
        <div class="stat-label">Usuarios</div>
      </div>
    </div>
  </div>
</div>

<div class="features-section">
  <div class="container">
    <h2>Caracter√≠sticas del Sistema</h2>
    <div class="features-grid">
      <div class="feature-card">
        <h3>üåê API REST</h3>
        <p>API RESTful completa con endpoints para todas las entidades</p>
        <a href="/api/" class="btn">Ver API</a>
      </div>
      <div class="feature-card">
        <h3>üßº Servicio SOAP</h3>
        <p>Web Service SOAP con WSDL para integraci√≥n empresarial</p>
        <a href="/soap/?wsdl" class="btn">Ver WSDL</a>
      </div>
      <div class="feature-card">
        <h3>üîê Panel Admin</h3>
        <p>Interfaz administrativa completa de Django</p>
        <a href="/admin/" class="btn">Acceder</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
 
2. libros/templates/libros/catalogo.html
// Muy parecido, solamente algunos cambios menores:

{% extends 'base.html' %} {% load static %} {% block title %}Cat√°logo -
Biblioteca UTH{% endblock %} {% block content %}
<div class="page-header">
  <div class="container">
    <h1>üìö Cat√°logo de Libros</h1>
    <p>Explora nuestra colecci√≥n de {{ total_libros }} libros</p>
  </div>
</div>

<div class="container">
  <div class="catalogo-layout">
    <aside class="filters-sidebar">
      <h3>Filtros</h3>
      <form method="get" id="filtros-form">
        <div class="filter-group">
          <label>Categor√≠a</label>
          <select name="categoria">
            <option value="">Todas</option>
            {% for cat in categorias %}
            <option value="{{ cat.id }}">{{ cat.nombre }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="filter-group">
          <label>Autor</label>
          <select name="autor">
            <option value="">Todos</option>
            {% for autor in autores %}
            <option value="{{ autor.id }}">{{ autor.nombre_completo }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="filter-group">
          <label>Estado</label>
          <select name="estado">
            <option value="">Todos</option>
            <option value="disponible">Disponible</option>
            <option value="prestado">Prestado</option>
          </select>
        </div>

        <button type="submit" class="btn btn-primary">Aplicar Filtros</button>
      </form>
    </aside>

    <div class="catalogo-content">
      <div class="libros-grid">
        {% for libro in libros %}
        <div class="libro-card">
          <div class="libro-imagen">
            <div class="libro-placeholder">üìñ</div>
          </div>
          <div class="libro-info">
            <h3>{{ libro.titulo }}</h3>
            <p class="libro-autor">{{ libro.autor.nombre_completo }}</p>
            <p class="libro-editorial">{{ libro.editorial.nombre }}</p>
            <div class="libro-meta">
              <span class="badge badge-categoria"
                >{{ libro.categoria.nombre }}</span
              >
              {% if libro.stock_disponible > 0 %}
              <span class="badge badge-disponible"
                >Disponible ({{ libro.stock_disponible }})</span
              >
              {% else %}
              <span class="badge badge-prestado">No disponible</span>
              {% endif %}
            </div>
            <a href="{% url 'detalle_libro' libro.id %}" class="btn btn-sm"
              >Ver Detalles</a
            >
          </div>
        </div>
        {% empty %}
        <p>No se encontraron libros con los filtros seleccionados.</p>
        {% endfor %}
      </div>

      {% if libros.has_other_pages %}
      <div class="pagination">
        {% if libros.has_previous %}
        <a href="?page=1" class="btn">Primera</a>
        <a href="?page={{ libros.previous_page_number }}" class="btn"
          >Anterior</a
        >
        {% endif %}

        <span
          >P√°gina {{ libros.number }} de {{ libros.paginator.num_pages }}</span
        >

        {% if libros.has_next %}
        <a href="?page={{ libros.next_page_number }}" class="btn">Siguiente</a>
        <a href="?page={{ libros.paginator.num_pages }}" class="btn">√öltima</a>
        {% endif %}
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

3. libros/templates/libros/detalle_libro.html
// Muy parecido, solamente algunos cambios menores:

{% extends 'base.html' %} {% load static %} {% block title %}{{ libro.titulo }}
- Biblioteca UTH{% endblock %} {% block content %}
<div class="container">
  <div class="breadcrumb">
    <a href="{% url 'home' %}">Inicio</a> /
    <a href="{% url 'catalogo' %}">Cat√°logo</a> /
    <span>{{ libro.titulo }}</span>
  </div>

  <div class="libro-detalle-layout">
    <div class="libro-imagen-grande">
      <div class="libro-placeholder-grande">üìñ</div>
    </div>

    <div class="libro-detalle-info">
      <h1>{{ libro.titulo }}</h1>
      <p class="libro-autor-grande">Por {{ libro.autor.nombre_completo }}</p>

      <div class="libro-meta-info">
        <div class="meta-item"><strong>ISBN:</strong> {{ libro.isbn }}</div>
        <div class="meta-item">
          <strong>Editorial:</strong> {{ libro.editorial.nombre }}
        </div>
        <div class="meta-item">
          <strong>Categor√≠a:</strong> {{ libro.categoria.nombre }}
        </div>
        <div class="meta-item">
          <strong>A√±o:</strong> {{ libro.fecha_publicacion|date:"Y" }}
        </div>
        <div class="meta-item">
          <strong>P√°ginas:</strong> {{ libro.numero_paginas }}
        </div>
        <div class="meta-item">
          <strong>Stock Total:</strong> {{ libro.stock_total }}
        </div>
        <div class="meta-item">
          <strong>Disponibles:</strong>
          {% if libro.stock_disponible > 0 %}
          <span class="text-success">{{ libro.stock_disponible }}</span>
          {% else %}
          <span class="text-danger">No disponible</span>
          {% endif %}
        </div>
      </div>

      {% if libro.descripcion %}
      <div class="libro-descripcion">
        <h3>Descripci√≥n</h3>
        <p>{{ libro.descripcion }}</p>
      </div>
      {% endif %} {% if libro.stock_disponible > 0 %}
      <div class="libro-acciones">
        {% if user.is_authenticated %}
        <a
          href="{% url 'solicitar_prestamo' libro.id %}"
          class="btn btn-primary btn-lg"
        >
          üìã Solicitar Pr√©stamo
        </a>
        {% else %}
        <a
          href="{% url 'login' %}?next={{ request.path }}"
          class="btn btn-primary btn-lg"
        >
          Iniciar sesi√≥n para pedir prestado
        </a>
        {% endif %}
      </div>
      {% endif %}
    </div>
  </div>

  <div class="autor-info-section">
    <h2>Sobre el Autor</h2>
    <div class="autor-card">
      <h3>{{ libro.autor.nombre_completo }}</h3>
      {% if libro.autor.nacionalidad %}
      <p><strong>Nacionalidad:</strong> {{ libro.autor.nacionalidad }}</p>
      {% endif %} {% if libro.autor.biografia %}
      <p>{{ libro.autor.biografia }}</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

4. libros/templates/libros/estadisticas.html
// Mucho cambio en esto

{% extends 'base.html' %} {% load static %} {% block title %}Estad√≠sticas -
Biblioteca UTH{% endblock %} {% block content %}
<div class="container mt-4 mb-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>üìä Estad√≠sticas del Sistema</h1>
    <span class="text-muted">Resumen general de la biblioteca</span>
  </div>

  <div class="row g-4">
    <div class="col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">
            <i class="fas fa-book-open me-2"></i>Libros por Categor√≠a
          </h5>
        </div>
        <div class="card-body d-flex justify-content-center align-items-center">
          <div style="height: 300px; width: 100%; position: relative">
            <canvas id="chart-categorias"></canvas>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">
            <i class="fas fa-user-tag me-2"></i>Top Autores Populares
          </h5>
        </div>
        <div class="card-body">
          <div style="height: 300px; width: 100%; position: relative">
            <canvas id="chart-autores"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-dark text-white">
          <h5 class="mb-0">üìã Detalle de Autores M√°s Prestados</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Autor</th>
                  <th>Nacionalidad</th>
                  <th class="text-center">Total Pr√©stamos</th>
                </tr>
              </thead>
              <tbody>
                {% for autor in top_autores %}
                <tr>
                  <td class="align-middle fw-bold">
                    {{ autor.nombre }} {{ autor.apellido }}
                  </td>
                  <td class="align-middle">{{ autor.nacionalidad }}</td>
                  <td class="text-center align-middle">
                    <span class="badge rounded-pill bg-primary fs-6">
                      {{ autor.total_prestamos }}
                    </span>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="3" class="text-center py-4 text-muted">
                    <i class="fas fa-inbox fa-2x mb-2"></i><br />
                    No hay datos de pr√©stamos registrados a√∫n.
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {

      // --- GR√ÅFICO 1: CATEGOR√çAS ---
      const ctxCat = document.getElementById('chart-categorias').getContext('2d');
      const catLabels = [{% for c in libros_por_categoria %}"{{ c.nombre }}",{% endfor %}];
      const catData = [{% for c in libros_por_categoria %}{{ c.total }},{% endfor %}];

      new Chart(ctxCat, {
          type: 'doughnut',
          data: {
              labels: catLabels,
              datasets: [{
                  label: 'Cantidad de Libros',
                  data: catData,
                  backgroundColor: [
                      '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b', '#858796'
                  ],
                  hoverOffset: 4
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false, // ¬°IMPORTANTE: Permite ajustar al div padre!
              plugins: {
                  legend: {
                      position: 'right', // Pone la leyenda a la derecha para ahorrar altura
                      labels: { padding: 20, boxWidth: 12 }
                  }
              },
              layout: {
                  padding: 10
              }
          }
      });

      // --- GR√ÅFICO 2: AUTORES ---
      const ctxAut = document.getElementById('chart-autores').getContext('2d');
      const autLabels = [{% for a in top_autores %}"{{ a.nombre }} {{ a.apellido }}",{% endfor %}];
      const autData = [{% for a in top_autores %}{{ a.total_prestamos }},{% endfor %}];

      new Chart(ctxAut, {
          type: 'bar',
          data: {
              labels: autLabels,
              datasets: [{
                  label: 'Pr√©stamos Totales',
                  data: autData,
                  backgroundColor: '#1cc88a',
                  borderColor: '#17a673',
                  borderWidth: 1,
                  borderRadius: 4 // Bordes redondeados en las barras
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false, // ¬°IMPORTANTE: Permite ajustar al div padre!
              scales: {
                  y: {
                      beginAtZero: true,
                      ticks: { stepSize: 1 },
                      grid: { borderDash: [2] } // L√≠neas punteadas para estilo m√°s limpio
                  },
                  x: {
                      grid: { display: false } // Oculta l√≠neas verticales
                  }
              },
              plugins: {
                  legend: { display: false } // Ocultamos leyenda porque ya dice el t√≠tulo
              }
          }
      });
  });
</script>
{% endblock %}

5. libros/templates/libros/mi_cuenta.html
//Cambios mayores

{% extends 'base.html' %} {% load static %} {% block title %}Mi
Perfil{%endblock%} {% block content %}
<div class="container py-5">
  <div class="row">
    <div class="col-md-4 mb-4">
      <div class="card shadow-sm text-center border-0">
        <div class="card-body py-4 bg-white rounded">
          <div
            class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center mx-auto mb-3"
            style="width: 80px; height: 80px; font-size: 2rem"
          >
            {{ user.username|slice:":1"|upper }}
          </div>

          <h3 class="fw-bold">{{ user.first_name }} {{ user.last_name }}</h3>
          <p class="text-muted">@{{ user.username }}</p>
          <span class="badge bg-light text-dark border">{{ user.email }}</span>
        </div>

        <div class="list-group list-group-flush mt-3 text-start">
          <a
            href="#activos"
            class="list-group-item list-group-item-action active"
          >
            <i class="fas fa-book-reader me-2"></i> Pr√©stamos Activos
          </a>
          <a href="#historial" class="list-group-item list-group-item-action">
            <i class="fas fa-history me-2"></i> Historial
          </a>
        </div>
      </div>
    </div>

    <div class="col-md-8">
      <div id="activos" class="mb-5">
        <h3 class="mb-3 border-start border-4 border-primary ps-3">
          üìñ Pr√©stamos en Curso
        </h3>

        {% if prestamos_activos %}
        <div class="row g-3">
          {% for prestamo in prestamos_activos %}
          <div class="col-12">
            <div
              class="card shadow-sm h-100 border-start-0 border-end-0 border-top-0 border-bottom-0"
              style="border-left: 5px solid #0d6efd !important"
            >
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h5 class="card-title fw-bold text-primary mb-1">
                      {{ prestamo.libro.titulo }}
                    </h5>
                    <p class="text-muted mb-2 small">
                      {{ prestamo.libro.autor.nombre }} {{ prestamo.libro.autor.apellido }}
                    </p>
                    <p class="mb-0">
                      <small class="text-muted"
                        >Prestado: {{ prestamo.fecha_prestamo|date:"d M Y"}}</small
                      >
                    </p>
                  </div>

                  <div class="text-end">
                    {% if prestamo.esta_vencido %}
                    <span class="badge bg-danger mb-2">VENCIDO</span>
                    {% else %}
                    <span class="badge bg-success mb-2">AL D√çA</span>
                    {% endif %}

                    <div class="mt-2">
                      <small class="text-danger fw-bold d-block mb-1">
                        Vence: {{ prestamo.fecha_devolucion_esperada|date:"d M Y" }}
                      </small>
                      <a
                        href="{% url 'renovar_prestamo' prestamo.id %}"
                        class="btn btn-outline-primary btn-sm"
                        >Renovar</a
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-info d-flex align-items-center shadow-sm">
          <i class="fas fa-info-circle me-3 fs-4"></i>
          <div>
            No tienes libros prestados actualmente.
            <a href="{% url 'catalogo' %}" class="alert-link">Ir al cat√°logo</a
            >.
          </div>
        </div>
        {% endif %}
      </div>

      <div id="historial">
        <h3 class="mb-3 border-start border-4 border-secondary ps-3">
          üìú Historial Pasado
        </h3>
        <div class="card shadow-sm border-0">
          <div class="table-responsive">
            <table class="table table-hover table-striped mb-0">
              <thead class="table-light">
                <tr>
                  <th class="ps-4">Libro</th>
                  <th>Prestado</th>
                  <th>Devuelto</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>
                {% for p in historial_prestamos %}
                <tr>
                  <td class="ps-4 fw-bold">{{ p.libro.titulo }}</td>
                  <td>{{ p.fecha_prestamo|date:"d/m/Y" }}</td>
                  <td>{{ p.fecha_devolucion_real|default:"-" }}</td>
                  <td>
                    <span class="badge bg-secondary">{{ p.estado }}</span>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="4" class="text-center text-muted py-4">
                    Tu historial est√° limpio.
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

6. libros/templates/libros/solicitar_prestamo.html
//Cambios mayores

{% extends 'base.html' %}
{% load static %}

{% block title %}Solicitar: {{ libro.titulo }}{% endblock %}

{% block content %}
<div class="container d-flex justify-content-center align-items-center" style="min-height: 85vh;">
    
    <div class="card shadow-lg border-0 overflow-hidden" style="max-width: 900px; width: 100%; border-radius: 20px;">
        <div class="row g-0">
            
            <div class="col-lg-5 text-white d-flex flex-column justify-content-center align-items-center p-5 position-relative" 
                 style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);">
                
                <div style="position: absolute; top: -50px; left: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
                
                <div class="mb-4 text-center">
                    <span style="font-size: 5rem; display: block; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2));">üìñ</span>
                </div>
                
                <h3 class="fw-bold text-center mb-2">{{ libro.titulo }}</h3>
                <p class="text-white-50 text-center mb-4">
                    <i class="fas fa-user-edit me-1"></i> {{ libro.autor.nombre_completo }}
                </p>

                <div class="badge bg-white text-primary px-3 py-2 rounded-pill shadow-sm mb-3">
                    <i class="fas fa-check-circle me-1"></i> {{ libro.stock_disponible }} Copias disponibles
                </div>
                
                <div class="small text-white-50 text-center mt-3">
                    <i class="fas fa-info-circle me-1"></i>
                    ISBN: {{ libro.isbn }}
                </div>
            </div>

            <div class="col-lg-7 bg-white p-5">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="fw-bold text-dark m-0">Confirmar Solicitud</h2>
                    <span class="text-muted small">Paso 1 de 1</span>
                </div>

                <form method="post">
                    {% csrf_token %}

                    <div class="form-floating mb-3">
                        <select name="dias" class="form-select border-2" id="id_dias" required style="border-radius: 12px;">
                            <option value="7">7 d√≠as (Semana corta)</option>
                            <option value="14" selected>14 d√≠as (Est√°ndar)</option>
                            <option value="21">21 d√≠as (Extendido)</option>
                            <option value="30">30 d√≠as (Mes completo)</option>
                        </select>
                        <label for="id_dias" class="text-muted"><i class="far fa-calendar-alt me-1"></i> Duraci√≥n del pr√©stamo</label>
                    </div>

                    <div class="form-floating mb-4">
                        <textarea name="notas" class="form-control border-2" placeholder="Notas" id="id_notas" style="height: 100px; border-radius: 12px;"></textarea>
                        <label for="id_notas" class="text-muted"><i class="far fa-comment-dots me-1"></i> Notas adicionales (Opcional)</label>
                    </div>

                    <div class="alert alert-light border d-flex align-items-start mb-4 rounded-3">
                        <input class="form-check-input mt-1 me-3" type="checkbox" name="acepto_terminos" id="id_terminos" required style="transform: scale(1.2);">
                        <label class="form-check-label small text-muted" for="id_terminos">
                            Me comprometo a cuidar el material y devolverlo en la fecha estipulada. Entiendo que el retraso puede generar sanciones en mi cuenta de biblioteca.
                        </label>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{% url 'detalle_libro' libro.id %}" class="btn btn-light btn-lg px-4 rounded-pill fw-bold text-muted">
                            Cancelar
                        </a>
                        <button type="submit" class="btn btn-primary btn-lg px-5 rounded-pill fw-bold shadow-sm">
                            Confirmar <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                    </div>

                </form>
            </div>
            
        </div>
    </div>
</div>

<style>
    .form-select:focus, .form-control:focus {
        border-color: #6366f1;
        box-shadow: 0 0 0 0.25rem rgba(99, 102, 241, 0.25);
    }
    .form-check-input:checked {
        background-color: #6366f1;
        border-color: #6366f1;
    }
</style>
{% endblock %}

7. libros/templates/libros/login.html
//Crear nuevo template para el login

{% extends 'base.html' %}

{% block title %}Iniciar Sesi√≥n{% endblock %}

{% block content %}
<div class="container d-flex justify-content-center align-items-center" style="min-height: 80vh;">
  <div class="card shadow-lg border-0" style="max-width: 400px; width: 100%;">
    <div class="card-body p-4">
      
      <div class="text-center mb-4">
        <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3" style="width: 60px; height: 60px;">
          <i class="fas fa-user fa-lg"></i>
        </div>
        <h3 class="fw-bold">Bienvenido</h3>
        <p class="text-muted small">Ingresa tus credenciales para acceder</p>
      </div>

      <form method="post">
        {% csrf_token %}
        
        {% if form.errors %}
          <div class="alert alert-danger py-2 small">
            Usuario o contrase√±a incorrectos.
          </div>
        {% endif %}

        <div class="mb-3">
          <label class="form-label fw-bold small text-muted">Usuario</label>
          {{ form.username }} 
          </div>

        <div class="mb-4">
          <label class="form-label fw-bold small text-muted">Contrase√±a</label>
          {{ form.password }}
        </div>

        <button type="submit" class="btn btn-primary w-100 py-2 fw-bold shadow-sm">
          INGRESAR
        </button>
      </form>

    </div>
  </div>
</div>

<style>
  /* Hacemos que los inputs que genera Django ocupen todo el ancho y se vean modernos */
  input[type="text"], input[type="password"] {
    width: 100%;
    padding: 0.5rem 0.75rem;
    font-size: 1rem;
    border: 1px solid #ced4da;
    border-radius: 0.375rem;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
  }
  input[type="text"]:focus, input[type="password"]:focus {
    border-color: #86b7fe;
    outline: 0;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }
</style>
{% endblock %}

8. libros/templates/libros/logout.html
//Crear nuevo template para el logout

{% extends 'base.html' %}

{% block title %}Sesi√≥n Cerrada{% endblock %}

{% block content %}
<div class="container d-flex justify-content-center align-items-center" style="min-height: 60vh;">
    <div class="card shadow-lg border-0 text-center" style="max-width: 450px; width: 100%;">
        <div class="card-body p-5">
            <div class="mb-4 text-primary">
                <i class="fas fa-door-open fa-4x"></i>
            </div>

            <h2 class="fw-bold mb-3">¬°Hasta pronto!</h2>
            <p class="text-muted mb-4">
                Has cerrado tu sesi√≥n correctamente. <br>
                Gracias por visitar la Biblioteca UTH.
            </p>

            <div class="d-grid gap-2">
                <a href="{% url 'login' %}" class="btn btn-primary btn-lg">
                    <i class="fas fa-sign-in-alt me-2"></i> Iniciar Sesi√≥n de nuevo
                </a>
                
                <a href="/" class="btn btn-outline-secondary">
                    Volver al Inicio
                </a>
            </div>
        </div>
        <div class="card-footer bg-light py-3">
            <small class="text-muted">¬øNo cerraste sesi√≥n t√∫? <a href="{% url 'login' %}">Ingresa aqu√≠</a></small>
        </div>
    </div>
</div>
{% endblock %}

 -- 16.5.4 Cambiar el cliente_soap_visual.py

 #!/usr/bin/env python3
"""
Cliente SOAP Visual - Sistema de Biblioteca
Ejecuta operaciones y muestra XML en navegador
"""

from zeep import Client, Settings
from zeep.exceptions import Fault
from zeep.plugins import HistoryPlugin
import sys
import webbrowser
import os
import tempfile
from datetime import datetime
from lxml import etree

WSDL_URL = 'http://127.0.0.1:8000/soap/?wsdl'

# Plugin para capturar mensajes SOAP
history = HistoryPlugin()

def crear_cliente():
    """Crea cliente SOAP con configuraci√≥n optimizada"""
    try:
        settings = Settings(strict=False, xml_huge_tree=True, xsd_ignore_sequence_order=True)
        client = Client(WSDL_URL, settings=settings, plugins=[history])
        return client
    except Exception as e:
        print(f"‚ùå Error al conectar con el servidor SOAP: {e}")
        print("\nüí° Aseg√∫rate de que el servidor Django est√© corriendo:")
        print("   python manage.py runserver")
        sys.exit(1)

def formatear_xml(xml_string):
    """Formatea XML para mejor visualizaci√≥n"""
    try:
        parser = etree.XMLParser(remove_blank_text=True)
        root = etree.fromstring(xml_string, parser)
        return etree.tostring(root, pretty_print=True, encoding='unicode')
    except:
        return xml_string

def mostrar_xml_en_navegador(request_xml, response_xml, operacion):
    """Genera HTML con XML SOAP y lo abre en navegador"""
    import html
    
    request_formatted = formatear_xml(request_xml)
    response_formatted = formatear_xml(response_xml)
    
    request_escaped = html.escape(request_formatted)
    response_escaped = html.escape(response_formatted)
    
    html_content = f"""
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>üîç XML SOAP - {operacion}</title>
    <style>
        body {{ font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; }}
        .container {{ max-width: 1600px; margin: 0 auto; background: white; border-radius: 15px; overflow: hidden; }}
        .header {{ background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px 40px; text-align: center; }}
        .section-title {{ background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 25px; border-radius: 10px; }}
        .xml-container {{ background: #1e1e1e; border-radius: 10px; padding: 25px; overflow: auto; max-height: 600px; }}
        pre {{ margin: 0; color: #d4d4d4; font-family: 'Consolas', 'Monaco', monospace; white-space: pre-wrap; }}
        .copy-btn {{ background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 15px; }}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Visualizador de XML SOAP</h1>
            <div>Operaci√≥n: {operacion}</div>
            <div>Timestamp: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}</div>
        </div>
        <div style="padding: 40px;">
            <div style="margin-bottom: 40px;">
                <div class="section-title">üì§ SOAP Request</div>
                <div class="xml-container">
                    <pre id="request-xml">{request_escaped}</pre>
                </div>
                <button class="copy-btn" onclick="copyToClipboard('request-xml')">üìã Copiar Request</button>
            </div>
            <div>
                <div class="section-title">üì• SOAP Response</div>
                <div class="xml-container">
                    <pre id="response-xml">{response_escaped}</pre>
                </div>
                <button class="copy-btn" onclick="copyToClipboard('response-xml')">üìã Copiar Response</button>
            </div>
        </div>
    </div>
    <script>
        function copyToClipboard(elementId) {{
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {{
                const btn = event.target;
                btn.textContent = '‚úÖ Copiado!';
                setTimeout(() => btn.textContent = btn.textContent.includes('Request') ? 'üìã Copiar Request' : 'üìã Copiar Response', 2000);
            }});
        }}
    </script>
</body>
</html>
"""
    
    with tempfile.NamedTemporaryFile(mode='w', delete=False, suffix='.html', encoding='utf-8') as f:
        f.write(html_content)
        temp_file = f.name
    
    print(f"\nüåê Abriendo visualizador XML en el navegador...")
    webbrowser.open('file://' + os.path.abspath(temp_file))

def preguntar_ver_xml():
    """Pregunta si desea ver el XML"""
    print("\n" + "="*80)
    respuesta = input("¬øDesea ver el XML SOAP en el navegador? (s/n): ").strip().lower()
    return respuesta in ['s', 'si', 's√≠', 'y', 'yes']

def listar_libros(client):
    """Lista todos los libros"""
    print("\n" + "="*80)
    print("üìö LISTANDO TODOS LOS LIBROS")
    print("="*80)
    
    try:
        result = client.service.listar_libros()
        
        if not result:
            print("\n‚ö†Ô∏è  No hay libros registrados")
            return
        
        print(f"\n‚úÖ Se encontraron {len(result)} libros:\n")
        
        for i, libro in enumerate(result, 1):
            print(f"{i}. üìñ {libro.titulo} (ID: {libro.id})")
            print(f"   ‚úçÔ∏è  Autor: {libro.autor_nombre}")
            print(f"   üì¶ Disponibles: {libro.stock_disponible}")
        
        if preguntar_ver_xml():
            request_xml = etree.tostring(history.last_sent['envelope'], encoding='unicode', pretty_print=True)
            response_xml = etree.tostring(history.last_received['envelope'], encoding='unicode', pretty_print=True)
            mostrar_xml_en_navegador(request_xml, response_xml, "listar_libros")
            
    except Exception as e:
        print(f"\n‚ùå Error: {e}")

def obtener_libro(client):
    """Obtiene detalles de un libro por ID"""
    print("\n" + "="*80)
    print("üîç OBTENER LIBRO POR ID")
    print("="*80)
    
    try:
        libro_id = int(input("\nIngrese el ID del libro: "))
        result = client.service.obtener_libro(libro_id)
        
        if not result:
            print(f"\n‚ö†Ô∏è  No se encontr√≥ libro con ID {libro_id}")
            return
        
        print(f"\n‚úÖ Libro encontrado:")
        print(f"üìñ {result.titulo}")
        print(f"‚úçÔ∏è  Autor: {result.autor.nombre} {result.autor.apellido}")
        print(f"üìÑ P√°ginas: {result.numero_paginas} | Idioma: {result.idioma}")
        print(f"üì¶ Stock: {result.stock_disponible}")
        
        if preguntar_ver_xml():
            request_xml = etree.tostring(history.last_sent['envelope'], encoding='unicode', pretty_print=True)
            response_xml = etree.tostring(history.last_received['envelope'], encoding='unicode', pretty_print=True)
            mostrar_xml_en_navegador(request_xml, response_xml, f"obtener_libro (ID: {libro_id})")
            
    except Exception as e:
        print(f"\n‚ùå Error: {e}")

def crear_prestamo(client):
    """Crea un nuevo pr√©stamo"""
    print("\n" + "="*80)
    print("‚ûï CREAR NUEVO PR√âSTAMO")
    print("="*80)
    
    try:
        libro_id = int(input("\nID del libro: "))
        usuario_id = int(input("ID del usuario: "))
        dias = int(input("D√≠as de pr√©stamo: "))
        
        result = client.service.crear_prestamo(libro_id, usuario_id, dias)
        
        if result.exito:
            print(f"\n‚úÖ {result.mensaje}")
            print(f"   ID del pr√©stamo: {result.id}")
        else:
            print(f"\n‚ùå {result.mensaje}")
        
        if preguntar_ver_xml():
            request_xml = etree.tostring(history.last_sent['envelope'], encoding='unicode', pretty_print=True)
            response_xml = etree.tostring(history.last_received['envelope'], encoding='unicode', pretty_print=True)
            mostrar_xml_en_navegador(request_xml, response_xml, "crear_prestamo")
            
    except Exception as e:
        print(f"\n‚ùå Error: {e}")

def mostrar_menu():
    """Muestra el men√∫ principal"""
    print("\n" + "="*80)
    print("üèõÔ∏è  SISTEMA DE BIBLIOTECA - CLIENTE SOAP VISUAL")
    print("="*80)
    print("\nüìö OPERACIONES:")
    print("  1. Listar todos los libros")
    print("  2. Obtener libro por ID")
    print("  3. Crear pr√©stamo")
    print("\n  0. Salir")
    print("="*80)

def main():
    """Funci√≥n principal"""
    print("\nüîå Conectando al servidor SOAP...")
    client = crear_cliente()
    print("‚úÖ Conexi√≥n establecida")
    
    operaciones = {
        '1': listar_libros,
        '2': obtener_libro,
        '3': crear_prestamo,
    }
    
    while True:
        mostrar_menu()
        opcion = input("\nSeleccione una opci√≥n: ").strip()
        
        if opcion == '0':
            print("\nüëã ¬°Hasta luego!")
            break
        
        if opcion in operaciones:
            operaciones[opcion](client)
        else:
            print("\n‚ùå Opci√≥n inv√°lida")
        
        input("\n‚èé Presione Enter para continuar...")

if __name__ == '__main__':
    try:
        main()
    except KeyboardInterrupt:
        print("\n\nüëã ¬°Hasta luego!")
        sys.exit(0)

 -- 16.6.2 Dockerfile
1. Soporte para MySQL (Cambio Cr√≠tico)
C√≥digo Modificado (Secci√≥n apt-get):

RUN apt-get update && apt-get install -y \
    gcc \
    pkg-config \                  # <-- Agregado
    default-libmysqlclient-dev \  # <-- Agregado
    libxml2-dev \
    libxslt-dev \
    && rm -rf /var/lib/apt/lists/*

 -- 16.6.3 docker-compose.yml
1. Espera de Salud de la Base de Datos (condition: service_healthy)
C√≥digo Modificado:

YAML
# En el servicio 'web'
depends_on:
  db:
    condition: service_healthy # <-- TU CAMBIO

2. Compatibilidad de Autenticaci√≥n MySQL 8
C√≥digo Agregado:

services:
  # Base de datos MySQL
  db:
    image: mysql:8.0
    container_name: biblioteca_mysql
    //AGREGAR ESTA LINEA DE ABAJO
    command: --default-authentication-plugin=mysql_native_password --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
    restart: always

3. Prevenci√≥n de Conflictos de Puertos
C√≥digo Modificado:

YAML
ports:
  - "3307:3306" # <-- TU CAMBIO (Host:Contenedor)

 -- 16.6.5 docker-compose.scale.yml

1. Prevenci√≥n de Conflictos de Puertos
C√≥digo Modificado:

YAML
ports:
  - "3307:3306" # <-- TU CAMBIO (Host:Contenedor)

 -- 16.6.6 utilizar el populate.py en el Contenedor

docker cp populate.py biblioteca_web:/app/populate_manual.py
docker-compose exec web python /app/populate_manual.py